<h2 mat-dialog-title>Book Tee Time</h2>

<div *ngIf="submitting" class="loading-overlay">
  <mat-spinner diameter="50"></mat-spinner>
  <p>Processing your reservation...</p>
</div>

<mat-dialog-content>
  <p class="reservation-info">
    <strong>Course:</strong> {{ data.course?.name }}<br>
    <strong>Domain:</strong> {{ data.domain }}<br>
    <strong>Date:</strong> {{ data.date | date:'fullDate' }}<br>
    <strong>Time:</strong> {{ data.teeTime?.time | date:'shortTime' }}
  </p>

  <form [formGroup]="reservationForm" (ngSubmit)="onSubmit()">
    <h3>Teesnap Account Information</h3>
    <p class="hint-text">Please enter your Teesnap account information to complete this booking.</p>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Domain</mat-label>
        <input matInput formControlName="domain" readonly>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="Enter your Teesnap email">
        <mat-error *ngIf="reservationForm.get('email')?.hasError('required')">Email is required</mat-error>
        <mat-error *ngIf="reservationForm.get('email')?.hasError('email')">Please enter a valid email</mat-error>
      </mat-form-field>
    </div>

    <div class="form-row">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Password</mat-label>
        <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" placeholder="Enter your Teesnap password">
        <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="reservationForm.get('password')?.hasError('required')">Password is required</mat-error>
      </mat-form-field>
    </div>

    <div formGroupName="reservationData">
      <h3>Reservation Details</h3>

      <div class="form-row">
        <mat-form-field appearance="outline">
          <mat-label>Number of Players</mat-label>
          <mat-select formControlName="players">
            <mat-option [value]="1">1 Player</mat-option>
            <mat-option [value]="2">2 Players</mat-option>
            <mat-option [value]="3">3 Players</mat-option>
            <mat-option [value]="4">4 Players</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Holes</mat-label>
          <mat-select formControlName="holes">
            <mat-option *ngFor="let hole of data.teeTime?.holes" [value]="hole.toString()">
              {{ hole }} Holes
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tee Off Section</mat-label>
          <mat-select formControlName="teeOffSection">
            <mat-option value="FRONT_NINE">Front Nine</mat-option>
            <mat-option value="BACK_NINE">Back Nine</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <div class="disclaimer">
      <p>By clicking "Book Now", you agree to the course's cancellation policy and confirm that all provided information is correct.</p>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()" [disabled]="submitting">Cancel</button>
  <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="reservationForm.invalid || submitting">
    Book Now
  </button>
</mat-dialog-actions>
